# Hooks de automaÃ§Ã£o para Claude Code
# Projeto: Sistema Educacional Completo

# ===========================================
# PRE-TOOL USE HOOKS
# ===========================================

[[hooks]]
event = "PreToolUse"
priority = 1
[hooks.matcher]
tool_name = "Bash"
pattern = "rm|delete|drop"
[hooks.action]
type = "block"
message = "âš ï¸ OperaÃ§Ã£o destrutiva detectada. Use --force para confirmar ou revise o comando."

[[hooks]]
event = "PreToolUse"
priority = 2
[hooks.matcher]
tool_name = "Write|Edit"
file_paths = ["*.env", "*.key", "*.pem"]
[hooks.action]
type = "confirm"
message = "âš ï¸ Modificando arquivo sensÃ­vel. Tem certeza?"

# ===========================================
# POST-TOOL USE HOOKS
# ===========================================

[[hooks]]
event = "PostToolUse"
priority = 1
run_in_background = true
[hooks.matcher]
tool_name = "Edit|Write|MultiEdit"
file_paths = ["*.jsx", "*.js"]
[hooks.action]
type = "command"
command = """
#!/bin/bash
# Formatar cÃ³digo automaticamente
if command -v prettier &> /dev/null; then
    prettier --write $CLAUDE_FILE_PATHS 2>/dev/null || true
fi
# Verificar sintaxe
npx eslint $CLAUDE_FILE_PATHS --fix 2>/dev/null || true
"""
timeout = 15000

[[hooks]]
event = "PostToolUse"
priority = 2
[hooks.matcher]
tool_name = "Edit|Write"
file_paths = ["*.css", "*.scss"]
[hooks.action]
type = "command"
command = "npx prettier --write $CLAUDE_FILE_PATHS"
timeout = 10000

[[hooks]]
event = "PostToolUse"
priority = 3
[hooks.matcher]
tool_name = "Write"
file_paths = ["*.test.jsx", "*.test.js", "*.spec.js"]
[hooks.action]
type = "command"
command = "npm test -- $CLAUDE_FILE_PATHS --run 2>/dev/null || echo 'Teste criado, execute npm test para validar'"

# ===========================================
# SESSION HOOKS
# ===========================================

[[hooks]]
event = "SessionStart"
priority = 1
[hooks.action]
type = "script"
script = """
#!/bin/bash
echo "=== Claude Code Session Started ==="
echo "ğŸ“… Date: $(date '+%Y-%m-%d %H:%M:%S')"
echo "ğŸ‘¤ User: $(whoami)"
echo "ğŸ“ Directory: $(pwd)"
echo "ğŸŒ¿ Git Branch: $(git branch --show-current 2>/dev/null || echo 'not a git repo')"
echo "ğŸ“¦ Node: $(node -v)"
echo "ğŸ“¦ NPM: $(npm -v)"
echo ""
echo "ğŸš€ Project: Sistema Educacional Completo"
echo "âš¡ Quick Commands:"
echo "  - /fix <error> - Corrigir erro"
echo "  - /test - Rodar testes"
echo "  - /deploy local - Deploy local"
echo ""

# Verificar estado do projeto
if [ -f "package.json" ]; then
    echo "ğŸ“‹ Dependencies Status:"
    npm audit --audit-level=moderate 2>&1 | head -5
fi

# Verificar se servidor estÃ¡ rodando
if lsof -i:3000 &>/dev/null; then
    echo "âœ… Dev server running on port 3000"
else
    echo "â„¹ï¸ Dev server not running. Use 'npm run dev' to start"
fi
"""

[[hooks]]
event = "PreCompact"
priority = 1
[hooks.action]
type = "command"
command = """
echo "ğŸ“¦ Saving context before compacting..." && \
mkdir -p .claude/backups && \
echo "Context saved at $(date)" > .claude/backups/context-$(date +%Y%m%d-%H%M%S).md
"""

[[hooks]]
event = "Stop"
priority = 1
[hooks.action]
type = "script"
script = """
#!/bin/bash
echo "=== Claude Code Session Ended ==="
echo "ğŸ“… Date: $(date '+%Y-%m-%d %H:%M:%S')"

# Salvar estado da sessÃ£o
if [ -d ".claude" ]; then
    echo "Session ended at $(date)" >> .claude/session.log
    
    # Listar arquivos modificados
    echo "ğŸ“ Files modified in this session:"
    git status --short 2>/dev/null | head -10
    
    # Sugerir prÃ³ximos passos
    echo ""
    echo "ğŸ’¡ Suggested next steps:"
    if git diff --name-only | grep -q "test"; then
        echo "  - Run tests: npm test"
    fi
    if git diff --name-only | grep -q "jsx\|js"; then
        echo "  - Check build: npm run build"
    fi
    echo "  - Commit changes: git add . && git commit -m 'your message'"
fi
"""

# ===========================================
# ERROR HANDLING HOOKS
# ===========================================

[[hooks]]
event = "OnError"
priority = 1
[hooks.action]
type = "script"
script = """
#!/bin/bash
echo "âŒ Error detected in Claude Code session"
echo "Error details saved to .claude/error.log"
echo "$CLAUDE_ERROR" >> .claude/error.log
echo ""
echo "ğŸ’¡ Common fixes:"
echo "  - Check npm dependencies: npm install"
echo "  - Clear node_modules: rm -rf node_modules && npm install"
echo "  - Check for syntax errors: npm run lint"
"""

# ===========================================
# CUSTOM TRIGGER HOOKS
# ===========================================

[[hooks]]
event = "CustomTrigger"
trigger = "before_commit"
[hooks.action]
type = "script"
script = """
#!/bin/bash
echo "ğŸ” Pre-commit checks..."

# Verificar testes
npm test -- --run --silent
if [ $? -ne 0 ]; then
    echo "âŒ Tests failing. Fix before committing."
    exit 1
fi

# Verificar build
npm run build --silent
if [ $? -ne 0 ]; then
    echo "âŒ Build failing. Fix before committing."
    exit 1
fi

# Verificar linting
npm run lint --silent
if [ $? -ne 0 ]; then
    echo "âš ï¸ Linting issues found. Consider fixing."
fi

echo "âœ… Pre-commit checks passed!"
"""